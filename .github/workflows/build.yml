name: Create Release Pipeline

on:  
 release:
    types: [published]

env:
  PROJECT_NAME: SecureFileShredder              # Change this to your project name
  SOLUTION_FILE: ./SecureFileShredder.sln       # Change this to your solution file path
  BUILD_PATH: ./SecureFileShredder/bin/Release # Path where the build artifacts are stored
  ZIP_NAME: SecureFileShredder.zip              # Name of the zipped build folder

jobs:
  build-and-release:
    name: Pipeline to Release
    runs-on: windows-latest

    steps:
      - name: â›“ï¸ Checkout code
        uses: actions/checkout@v3

      - name: ğŸ› ï¸ Setup .NET Framework
        uses: microsoft/setup-msbuild@v1

      - name: ğŸ“¦ Restore NuGet packages
        run: nuget restore

      - name: ğŸš€ Build the project
        run: msbuild ${{ env.SOLUTION_FILE }} /p:Configuration=Release

      - name: ğŸ—œï¸ Zip the build folder
        run: |
          powershell Compress-Archive -Path ${{ env.BUILD_PATH }}\* -DestinationPath ${{ env.BUILD_PATH }}\${{ env.ZIP_NAME }}

      - name: ğŸ“¤ Upload build artifacts
        uses: actions/upload-artifact@v3
        with:
          name: build
          path: ${{ env.BUILD_PATH }}/${{ env.ZIP_NAME }}

      - name: â¬‡ï¸ Download build artifacts
        uses: actions/download-artifact@v3
        with:
          name: build

      - name: ğŸš€ğŸ“¤ Upload zip to GitHub release
        uses: softprops/action-gh-release@v1
        with:
          files: ${{ env.BUILD_PATH }}/${{ env.ZIP_NAME }}
        env:
          GITHUB_TOKEN: ${{ secrets.RELEASE_TOKEN }}
